<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="ks46team02.customerservice.mapper.customerserviceMapper">
	<resultMap type="QuestionDto" id="questionResultMap">
		<id column="question_code" property="questionCode" />
		<id column="question_title" property="questionTitle" />
		<id column="question_content" property="questionContent" />
		<id column="question_file" property="questionFile" />
		<id column="member_id" property="memberId" />
		<id column="question_type_code" property="questionTypeCode" />
		<id column="question_status" property="questionStarus" />
		<id column="question_reg_date" property="qustionRegDate" />
		<id column="question_modify_date" property="questionModityDate" />
		<id column="question_del_date" property="questionDelDate" />
		<id column="question_del_yn" property="qustionDelYN" />
	</resultMap>

	<insert id="writeQuestion" parameterType="questionDto">
		<selectKey keyProperty="questionCode" resultType="Int">
			select
			CONCAT('QU', LPAD(
			ifnull(substring(max(question_code), 3), 0) + 1,
			6,
			'0')) as newId from question;
		</selectKey>

		insert into question (question_code, question_title, question_content,
		question_file, member_id, question_type_code, question_status,
		question_reg_date, question_modify_date, question_del_date,
		question_del_yn)
		values (#{questionTitle},
		#{questionContent},
		#{questionFile}, #{memberId},
		#{questionTypeCode},
		#{questionStarus},
		CURDATE(), null, null, 'N')
	</insert>

	<select id="getquestionTypeName" parameterType="String"
		resultType="String">
		SELECT question_type_name FROM question_type WHERE
		question_type_code =
		#{question_type_code}
	</select>

	<select id="selectQuestionsList" resultMap="questionResultMap">
		SELECT
		q.question_code, q.question_title, m.member_name,
		q.question_reg_date
		FROM
		question q
		LEFT JOIN member_info m ON q.member_id = m.member_id
		WHERE
		q.question_type_code = #{question_type_code} AND
		q.question_del_yn =
		'N'
		ORDER BY q.question_code DESC;
	</select>

	<select id="selectQuestionInfo" resultType="QuestionDto">
		SELECT m.member_name,
		to_char(q.question_reg_date, 'YYYY-MM-DD'), q.question_title,
		q.question_content, q.question_file, q.member_id
		FROM question q
		INNER
		JOIN member_info m ON q.member_id = m.member_id
		WHERE q.question_code =
		#{code} AND q.question_del_yn = 'N';
	</select>

	<select id="getTotalCount" resultType="Int">
		SELECT COUNT(*)
		FROM
		question
		WHERE question_type_code = #{code}
		AND question_del_yn = 'N'
	</select>
</mapper>